Spring Boot によるWEB アプリケーションの開発マニュアル

# 概要
Spring Boot は，Java のWEB アプリケーションを作成するためのフレームワークである．
アーキテクチャの特徴としては，MVC の構造がきれいに守られていることが特徴である．
また，Spring Boot ではアプリケーションの作成に当たって多数の非常に便利な機能がモジュールという形で提供されており，これらを利用できる事こそが最大のメリットである(例: Spring Session, Spring Security, JPA, Lombok, Rest API 等々)．

# 準備
IDE 等を使ってSpring アプリケーションを作成する．
Eclipse で作る方法が一般的だが，今回は<a href="https://start.spring.io/">Spring Initializr</a> というweb サービスを使ってプロジェクトのひな型を作成する．
なお，```gradle init``` などとすれば，一応コマンドだけでSpring アプリケーションを作成することも可能である．

![Spring Initializr のサイトイメージ](https://github.com/Ailes-Grises/Java/blob/img/SpringBoot/SpringInitializr.jpg "Spring Initializr のサイトイメージ")

上記サイトで各項目の設定やモジュールの選択を行うと，zip ファイルがダウンロードされるので，これを展開したものがSpring アプリケーションのひな型となる．
以下はSpring アプリケーションの設定の一例である．
なお，Spring Boot のver2.4 系とver2.5 系では，data.sql の実行タイミングが異なるらしいので，注意すること．
```
 Project     : Gradle
 Language    : Java
 Packaging   : Jar
 Spring Boot : 2.4.8
 Java        : 8

 Dependencies : 
   - Spring Boot DevTools
   - Spring Web
   - Spring Session
   - Spring Security
   - Thymeleaf
   - Lombok
   - JDBC API
   - H2 Database
   - Spring Data JDBC
   - MySQL Driver
   - Rest Repositories
```

# 実行方法
通常，Spring Boot アプリケーションのビルドはEclipse やIntelliJ 等のIDE で行う事が多いが，これらのIDE の内部ではビルドツールとしてMaven かGradle が利用されている．
したがって，最初の雛形さえ作ってしまえば後はGradle コマンドでコンソール上からビルドすることが可能である．

```
 // プロジェクトルートの直下で以下のコマンドを実行
 $ ./gradlew bootRun

 // 前回の実行プロセスが正常に終了しなかったせいで，上記コマンドが実行できないことがある．
 // その場合はゾンビプロセスをkill してから実行する
 $ ps aux  // grep を使って絞ってもok
 $ kill プロセス番号(上記結果の左から二番目のカラムの値)
```

# Spring Boot の文法的な全体像
従来のHttpServlet によるWEB アプリでは，まず最初にフロント画面からコントローラを担当するサーブレットへのルーティングをweb.xml が担当し，これによってフロントで指定されたサーブレットクラスに処理が飛ばされ，さらにサーブレットクラスのdoGet() やdoPost() などの関数内で内部的に使用される一部のロジックがモデルクラスという形で定義されていた．
また，レスポンスの画面表示(サーブレットからフロントへのレスポンス)に関しては，結局サーブレットの内部でdipsatcher.forward() を使ってJSP ファイルを指定していたので，ルーティングの役割はweb.xml だけでは完結せず，サーブレットもルーティングの役割を果たす必要があった．
つまり，従来のサーブレットによるWEB アプリケーションのアーキテクチャは，MVC が当初目指していた「分業」という理念からずれてしまっている．
また，web.xml によるURL パターンの設定は非常に分かり辛いという欠点があった．

一方Spring Boot では，従来の様なweb.xml ファイルによるルーティングを行わない．
Spring では，基本的にアノテーションによってルーティングを実現しており，URL パターンも大変わかりやすい．
ルーティングの流れとしては，サーブレットの代わりに```@Controller```というアノテーションが付けられたクラスを使用し，このコントローラクラスの各メソッドにリクエストされたURLと同じURL パターンのアノテーションを付けることで，Spring が自動的にルーティングを実現してくれる．
したがって，同一のURL アノテーションのメソッドが複数存在しなければ，コントローラクラスはいくらでも作成することができる．
また，レスポンスの画面表示に関しても，各メソッドは戻り値としてString 型のURL パターンの文字列を返すため，このパターンに該当するメソッドがよばれることでフロント側への画面出力を実現している．

以上より，Spring ではルーティングによってコントローラクラスの各メソッドにリクエストが自動的に割り振られ，各メソッドはフロント側に最終的に出力するためのデータを加工・整備する役割がある．
そして，それを受け取ったJSP やThymeleaf は，コントローラのメソッドが用意してくれたデータをただ利用する，という流れになっている．
また，Thymeleaf 側のフォームなどで受け取ったデータ等は，コントローラクラスの該当メソッドの引数としてThymeleaf 側の変数名の冒頭を小文字にした変数を設定することで，自動的に受け取る事ができるようになっている．
このあたりの受け渡しをサポートしてくれているのは，おそらくDIインジェクションの恩恵だと思われる．

